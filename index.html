<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Auto TikTok Stats (DOM Extraction)</title>
</head>
<body>
  <h2>üîç Ki·ªÉm tra t∆∞∆°ng t√°c video TikTok</h2>
  <input
    type="text"
    id="url"
    placeholder="Nh·∫≠p link TikTok (vd: https://www.tiktok.com/@user/video/12345...)"
    size="70"
  />
  <button onclick="autoCheck()">Check</button>

  <div id="result" style="margin-top: 20px;"></div>

  <script>
    async function autoCheck() {
      const url = document.getElementById('url').value.trim();
      const resultDiv = document.getElementById('result');
      if (!url) {
        resultDiv.innerHTML = '<p style="color:red;">Vui l√≤ng nh·∫≠p link TikTok</p>';
        return;
      }
      resultDiv.innerHTML =
        '<p>‚è≥ ƒêang x·ª≠ l√Ω... Xin ch·ªù v√†i gi√¢y ƒë·ªÉ Puppeteer load trang.</p>';

      try {
        const resp = await fetch(`/api/auto?url=${encodeURIComponent(url)}`);
        const data = await resp.json();

        if (data.error) {
          resultDiv.innerHTML =
            `<p style="color:red;">‚ùå L·ªói: ${data.error}</p>` +
            (data.details ? `<pre>${data.details}</pre>` : '');
          console.log('Chi ti·∫øt l·ªói:', data.details);
          return;
        }

        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        resultDiv.innerHTML = `
          <p>‚ù§Ô∏è Likes: ${data.likes.toLocaleString()}</p>
          <p>üí¨ Comments: ${data.comments.toLocaleString()}</p>
          <p>‚≠ê Favorites: ${data.favorites.toLocaleString()}</p>
          <p>üîÑ Shares: ${data.shares.toLocaleString()}</p>
        `;

        // N·∫øu mu·ªën xem raw text (debug), b·ªè comment d√≤ng sau
        // resultDiv.innerHTML += `<pre>${JSON.stringify(data.raw, null, 2)}</pre>`;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML =
          `<p style="color:red;">‚ùå L·ªói k·∫øt n·ªëi ho·∫∑c x·ª≠ l√Ω tr√™n server</p>`;
      }
    }
  </script>
</body>
</html>
